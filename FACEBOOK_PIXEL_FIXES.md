# ุญู ูุดุงูู Facebook Pixel

## ุงููุดุงูู ุงูุชู ุชู ุญููุง:

### 1. ูุดููุฉ ุชูุฑุงุฑ ุงูุฃุญุฏุงุซ (Event Deduplication)
**ุงููุดููุฉ:** ูุชู ุฅุฑุณุงู ุฃุญุฏุงุซ Purchase ู ViewContent ูู ุฎูุงู ุงูุจูุณู ูุงูุฎุงุฏู ุจุฏูู `event_id` ููุง ูุณุจุจ ุงุญุชุณุงุจ ูุถุงุนู.

**ุงูุญู ุงููุทุจู:**
- ุฅูุดุงุก `event_id` ูุดุชุฑู ูุซุงุจุช ุจูู ุงูุจูุณู (client-side) ูุงูุฎุงุฏู (server-side)
- ุงุณุชุฎุฏุงู ูุนุฑูุงุช ุซุงุจุชุฉ ูุซู `transaction_id` ุฃู `product_id` ูุถูุงู ุงูุซุจุงุช
- ุชูุฑูุฑ ููุณ `event_id` ููู Facebook Conversions API

```typescript
// ุฅูุดุงุก event_id ุซุงุจุช ููุดุชุฑู
const createSharedEventId = (type: string, data: any): string => {
  const baseId = data?.transaction_id || data?.order_id || data?.content_ids?.[0] || data?.product_id;
  if (baseId) {
    return `${type}_${baseId}_${Date.now().toString().slice(-6)}`;
  }
  return `${type}_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;
};
```

### 2. ูุดููุฉ ูุทุงุจูุฉ ูุนุฑู ุงููุญุชูู (Content ID Matching)
**ุงููุดููุฉ:** ูุนุฑูุงุช ุงููุญุชูู ุงููุฑุณูุฉ ูุง ุชุทุงุจู ูุนุฑูุงุช ุงููุชุงููุฌ ููุง ูููู ูุนุฏู ุงููุทุงุจูุฉ.

**ุงูุญู ุงููุทุจู:**
- ุชูุธูู ูุชูุญูุฏ `content_ids` ูุจู ุงูุฅุฑุณุงู
- ุฅุถุงูุฉ `content_type: 'product'` ูุชุญุณูู ุงููุทุงุจูุฉ
- ุฏุนู ูุตุงุฏุฑ ูุชุนุฏุฏุฉ ููุนุฑู ุงูููุชุฌ (`product_id`, `content_id`, `content_ids`)

```typescript
// ุชูุธูู ูุชูุญูุฏ content_ids
const normalizeContentIds = (ids: any): string[] => {
  if (!ids) return [];
  if (Array.isArray(ids)) {
    return ids.map(id => String(id).trim()).filter(id => id.length > 0);
  }
  return [String(ids).trim()].filter(id => id.length > 0);
};

const contentIds = normalizeContentIds(data?.content_ids || data?.product_id || data?.content_id);
```

### 3. ุชุญุณููุงุช ุฅุถุงููุฉ
- ุชุญููู ุงูุนููุฉ ูู ุงูุฏููุงุฑ ุงูุนุฑุงูู ุฅูู ุงูุฏููุงุฑ ุงูุฃูุฑููู
- ุฅุถุงูุฉ `num_items` ูุชุญุฏูุฏ ูููุฉ ุงูููุชุฌุงุช
- ุชุญุณูู ุชุดููุฑ ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ ููู Conversions API
- ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ ูุซู `content_type` ู `content_category`

## ููููุฉ ุงุณุชุฎุฏุงู ุงูุฅุตูุงุญุงุช:

### 1. ููุฃุญุฏุงุซ ุงูุนุงุฏูุฉ:
```typescript
// ุงุณุชุฎุฏุงู PixelTracker ูุน ุงูุจูุงูุงุช ุงููุทููุจุฉ
<PixelTracker 
  platformId="your-platform-id"
  eventType="purchase"
  eventData={{
    content_ids: ["product_123"], // ูุนุฑู ุงูููุชุฌ ูู ุงููุชุงููุฌ
    content_name: "ุงุณู ุงูููุชุฌ",
    content_category: "ูุฆุฉ ุงูููุชุฌ",
    value: 25000, // ุจุงูุฏููุงุฑ ุงูุนุฑุงูู
    currency: "IQD",
    quantity: 1,
    transaction_id: "order_456", // ููู ูููุน ุงูุชูุฑุงุฑ
    customer_email: "customer@example.com",
    customer_phone: "07901234567"
  }}
/>
```

### 2. ููุชุฃูุฏ ูู ุนูู ุงูุฅุตูุงุญุงุช:
1. ุงูุชุญ Developer Tools ูู ุงููุชุตูุญ
2. ุชุงุจุน Console ููุฑุณุงุฆู ุงูุชุงููุฉ:
   - `๐ Shared Event ID created: [event_id]`
   - `โ Facebook Conversions API success`
   - `๐ Facebook Pixel: Event sent successfully`

### 3. ูุญุต Facebook Events Manager:
1. ุงุฐูุจ ุฅูู Facebook Events Manager
2. ุชุญูู ูู ุฃู ุงูุฃุญุฏุงุซ ุชุธูุฑ ูุฑุฉ ูุงุญุฏุฉ ููุท
3. ุชุฃูุฏ ูู ุฃู `content_ids` ุชุทุงุจู ูุนุฑูุงุช ุงููุชุงููุฌ
4. ุชุญูู ูู ูุนุฏู ุงููุทุงุจูุฉ (ูุฌุจ ุฃู ูููู ุฃุนูู ูู 50%)

## ูุตุงุฆุญ ูููุฉ:

### 1. ูุนุฑูุงุช ุงูููุชุฌุงุช:
- ุงุณุชุฎุฏู ููุณ ูุนุฑูุงุช ุงูููุชุฌุงุช ูู ุงููุชุงููุฌ ูุงูุฃุญุฏุงุซ
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณุงูุงุช ุฃู ุฃุญุฑู ุฎุงุตุฉ ูู ุงููุนุฑูุงุช
- ุงุณุชุฎุฏู ูุนุฑูุงุช ุซุงุจุชุฉ ูุง ุชุชุบูุฑ

### 2. ุจูุงูุงุช ุงูุนููุงุก:
- ุชุฃูุฏ ูู ุตุญุฉ ุนูุงููู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุงุณุชุฎุฏู ุฃุฑูุงู ุงูููุงุชู ุจุงูุตูุบุฉ ุงูุฏูููุฉ (+964...)
- ุฃุถู ุจูุงูุงุช ุงูุนููู ูููุง ุฃููู ูุชุญุณูู ุงููุทุงุจูุฉ

### 3. ูุฑุงูุจุฉ ุงูุฃุฏุงุก:
- ุฑุงูุจ ูุนุฏู ุงููุทุงุจูุฉ ูู Events Manager
- ุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุญุฏุงุซ ููุฑุฑุฉ
- ุฑุงุฌุน ุชูุงุฑูุฑ ุงูุฃุฏุงุก ุจุงูุชุธุงู

## ุงููููุงุช ุงููุญุฏุซุฉ:
- `/client/src/components/PixelTracker.tsx` - ุฅุตูุงุญ ุงูุจูุณู
- `/server/facebookConversions.ts` - ุฅุตูุงุญ ุงูุฎุงุฏู
- `/server/routes.ts` - ุชุญุฏูุซ API endpoint

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช:
1. ูู ุจุชุดุบูู ุงููููุน ูู ูุถุน ุงูุชุทููุฑ
2. ููุฐ ุนูููุฉ ุดุฑุงุก ุชุฌุฑูุจูุฉ
3. ุชุญูู ูู Console ููุฑุณุงุฆู
4. ุฑุงุฌุน Facebook Events Manager ููุชุฃูุฏ ูู ุนุฏู ุงูุชูุฑุงุฑ
